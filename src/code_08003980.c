#include "global.h"
#include "code_08003980.h"

asm(".include \"include/gba.inc\"");//Temporary

// Can be better split

#include "asm/code_08003980/asm_08003980.s"

#include "asm/code_08003980/asm_080039a8.s"

#include "asm/code_08003980/asm_080039d4.s"

#include "asm/code_08003980/asm_080039e8.s"

#include "asm/code_08003980/asm_08003a00.s"

#include "asm/code_08003980/asm_08003a18.s"

#include "asm/code_08003980/asm_08003a34.s"

#include "asm/code_08003980/asm_08003a40.s"

#include "asm/code_08003980/asm_08003a50.s"

#include "asm/code_08003980/asm_08003a6c.s"

#include "asm/code_08003980/asm_08003a78.s"

#include "asm/code_08003980/asm_08003a88.s"

#include "asm/code_08003980/asm_08003aa4.s"

#include "asm/code_08003980/asm_08003ab8.s"

#include "asm/code_08003980/asm_08003ac4.s"

#include "asm/code_08003980/asm_08003b28.s"

#include "asm/code_08003980/asm_08003b34.s"

#include "asm/code_08003980/asm_08003bd4.s"

#include "asm/code_08003980/asm_08003c18.s"

#include "asm/code_08003980/asm_08003c1c.s"

#include "asm/code_08003980/asm_08003de0.s"

#include "asm/code_08003980/asm_08003dec.s"

#include "asm/code_08003980/asm_08003e00.s"

#include "asm/code_08003980/asm_08003e64.s"

#include "asm/code_08003980/asm_08003ea4.s"

#include "asm/code_08003980/asm_08003eb8.s"

#include "asm/code_08003980/asm_08003f28.s"

#include "asm/code_08003980/asm_08003f50.s"

#include "asm/code_08003980/asm_08003fb4.s"

#include "asm/code_08003980/asm_08003ff0.s"

#include "asm/code_08003980/asm_0800402c.s"

#include "asm/code_08003980/asm_08004058.s"

#include "asm/code_08003980/asm_08004070.s"

#include "asm/code_08003980/asm_080041d0.s"

#include "asm/code_08003980/asm_08004248.s"

#include "asm/code_08003980/asm_0800425c.s"

#include "asm/code_08003980/asm_08004270.s"

#include "asm/code_08003980/asm_080042a4.s"

#include "asm/code_08003980/asm_080042bc.s"

#include "asm/code_08003980/asm_080043c8.s"

#include "asm/code_08003980/asm_080044f0.s"

#include "asm/code_08003980/asm_08004508.s"

#include "asm/code_08003980/asm_08004574.s"

#include "asm/code_08003980/asm_0800459c.s"

#include "asm/code_08003980/asm_080045b4.s"

#include "asm/code_08003980/asm_080045d0.s"

#include "asm/code_08003980/asm_080045fc.s"

#include "asm/code_08003980/asm_08004628.s"

#include "asm/code_08003980/asm_0800467c.s"

#include "asm/code_08003980/asm_080046c0.s"

#include "asm/code_08003980/asm_08004714.s"

#include "asm/code_08003980/asm_08004748.s"

#include "asm/code_08003980/asm_0800477c.s"

#include "asm/code_08003980/asm_0800496c.s"

#include "asm/code_08003980/asm_080049a0.s"

#include "asm/code_08003980/asm_080049dc.s"

#include "asm/code_08003980/asm_080049f0.s"

#include "asm/code_08003980/asm_08004b60.s"

#include "asm/code_08003980/asm_08004b70.s"

#include "asm/code_08003980/asm_08004b88.s"

#include "asm/code_08003980/asm_08004b98.s"

#include "asm/code_08003980/asm_08004bfc.s"

#include "asm/code_08003980/asm_08004c0c.s"

#include "asm/code_08003980/asm_08004c40.s"

#include "asm/code_08003980/asm_08004c50.s"

#include "asm/code_08003980/asm_08004cac.s"

#include "asm/code_08003980/asm_08004ccc.s"

#include "asm/code_08003980/asm_08004d44.s"

#include "asm/code_08003980/asm_08004da0.s"

#include "asm/code_08003980/asm_08004dc0.s"

#include "asm/code_08003980/asm_08004e60.s"

#include "asm/code_08003980/asm_08004e88.s"

#include "asm/code_08003980/asm_08004eac.s"

#include "asm/code_08003980/asm_08004ff4.s"

#include "asm/code_08003980/asm_08005014.s"

#include "asm/code_08003980/asm_080050bc.s"

#include "asm/code_08003980/asm_08005124.s"

#include "asm/code_08003980/asm_08005188.s"

#include "asm/code_08003980/asm_080051a4.s"

#include "asm/code_08003980/asm_080051c4.s"

#include "asm/code_08003980/asm_080051f0.s"

#include "asm/code_08003980/asm_08005208.s"

#include "asm/code_08003980/asm_08005328.s"

#include "asm/code_08003980/asm_0800536c.s"

#include "asm/code_08003980/asm_08005424.s"

#include "asm/code_08003980/asm_080054b0.s"

#include "asm/code_08003980/asm_080054f0.s"

#include "asm/code_08003980/asm_080055fc.s"

#include "asm/code_08003980/asm_08005640.s"

#include "asm/code_08003980/asm_0800568c.s"

#include "asm/code_08003980/asm_08005814.s"

#include "asm/code_08003980/asm_0800584c.s"

#include "asm/code_08003980/asm_08005858.s"

#include "asm/code_08003980/asm_08005878.s"

#include "asm/code_08003980/asm_080058b0.s"

#include "asm/code_08003980/asm_080058dc.s"

#include "asm/code_08003980/asm_0800598c.s"

#include "asm/code_08003980/asm_08005a0c.s"

#include "asm/code_08003980/asm_08005a40.s"

#include "asm/code_08003980/asm_08005a84.s"

#include "asm/code_08003980/asm_08005ad4.s"

#include "asm/code_08003980/asm_08005b20.s"

#include "asm/code_08003980/asm_08005bc4.s"

#include "asm/code_08003980/asm_08005c00.s"

#include "asm/code_08003980/asm_08005c3c.s"

#include "asm/code_08003980/asm_08005c78.s"

#include "asm/code_08003980/asm_08005ca8.s"

#include "asm/code_08003980/asm_08005ce0.s"

#include "asm/code_08003980/asm_08005cec.s"

#include "asm/code_08003980/asm_08005d38.s"

#include "asm/code_08003980/asm_08005d74.s"

#include "asm/code_08003980/asm_08005db0.s"

#include "asm/code_08003980/asm_08005de4.s"

#include "asm/code_08003980/asm_08005e18.s"

#include "asm/code_08003980/asm_08005e54.s"

#include "asm/code_08003980/asm_08005ee4.s"

#include "asm/code_08003980/asm_08005f04.s"

#include "asm/code_08003980/asm_08005f34.s"

#include "asm/code_08003980/asm_08005fe4.s"

#include "asm/code_08003980/asm_080060bc.s"

#include "asm/code_08003980/asm_080061a4.s"

#include "asm/code_08003980/asm_080061d0.s"

#include "asm/code_08003980/asm_0800620c.s"

#include "asm/code_08003980/asm_08006328.s"

#include "asm/code_08003980/asm_08006364.s"

#include "asm/code_08003980/asm_0800637c.s"

#include "asm/code_08003980/asm_08006448.s"

void func_0800650c(u32 *arg0, u32 arg1) {
    D_03000e9c = arg0;
    D_03000ea0 = arg1 / 4;

    if (D_03000ea0 > 0xFFFF) {
        D_03000ea0 = 0xFFFF;
    }

    arg0[0] = D_03000ea0 << 16;

    D_03004ad0.unk0 = 0;
    D_03004ad0.unk4 = arg0;
    D_03004ad0.unk8 = arg1;
    D_03004ad0.unk10 = 0;
    D_03004ad0.unkC = 0;

	DmaCopy32(3, &D_0800112c, &D_03000e48, ((u32)&D_0800116c - (u32)&D_0800112c));
	
    D_03000e98 = (functype_03000e98)&D_03000e48;
}

struct struct_030046a4 *func_08006580(u32 arg0) {
	return func_08006590(0, arg0);
}

// is this return type correct? it could possibly be a void*
struct struct_030046a4 *func_08006590(u16 arg0, u32 arg1) {
    u32 temp0 = (arg1+3)/4 + 1;
    s32 temp1 = D_03000e98(D_03000e9c, D_03000ea0, temp0);
    s32 temp2, temp3;

    if (temp1 < 0) {
        D_03004ad0.unk0 = 1;
        return NULL;
    }

    temp2 = (u16)(D_03000e9c[temp1] >> 16);
    D_03000e9c[temp1] = (temp0 << 16) | 0x8000 | arg0;
    temp3 = temp1 + temp0;

    if (temp0 < temp2) {
        D_03000e9c[temp3] = (temp2 - temp0) << 16;
    }

    if ((temp3 << 2) > D_03004ad0.unk10) {
        D_03004ad0.unk10 = (temp3 << 2);
    }

    return (struct struct_030046a4 *)(&(D_03000e9c[temp1]) + 1);
}

void func_08006628(u32 arg0, s32 arg1) {
    u32 temp2;

    D_03000e9c[arg0] &= 0xFFFF0000;

    if (arg1 >= 0) {
        if ((D_03000e9c[arg1] & 0x8000) == 0) {
            D_03000e9c[arg1] += D_03000e9c[arg0];
            arg0 = arg1;
        }
    }

    temp2 = arg0 + (D_03000e9c[arg0] >> 16);
    if (temp2 < D_03000ea0) {
        if ((D_03000e9c[temp2] & 0x8000) == 0) {
            D_03000e9c[arg0] += D_03000e9c[temp2];
        }
    }
}

void func_08006694(struct struct_030046a4 *arg0) {
    s32 temp0,temp1,temp2;

    if ((u32)arg0 & 0x3) {
        return;
    }
	
    temp0 = ((u32)arg0 - (u32)D_03000e9c) / 4 - 1; // definitely some kind of size
    if ((temp0 < 0) || (temp0 >= D_03000ea0)) {
        return;
    }

    temp2 = -1;
    temp1 = 0;

    if (temp1 >= D_03000ea0) {
        return;
    }

    while (temp1 <= temp0) {
        if (temp1 == temp0) {
            func_08006628(temp0,temp2);
            break;
        }
		
        temp2 = temp1;
		temp1 += D_03000e9c[temp1] >> 16;
		
        if (temp1 >= D_03000ea0) {
            break;
        }
    }
}

void func_080066f8(u16 arg0) {
    u32 temp2, temp0, temp1;
    
    if (arg0 == 0) {
        return;
    }

    temp2 = -1;
    temp0 = arg0 | 0x8000;
    temp1 = 0;

    while (temp1 < D_03000ea0) {
        if ((u16)D_03000e9c[temp1] == temp0) {
            func_08006628(temp1,temp2);
        }

        temp2 = temp1;
        temp1 += D_03000e9c[temp1] >> 16;

        if (temp1 >= D_03000ea0) {
            break;
        }
    }
}

void func_08006750(void) {
    u32 temp0 = 0;
    u32 temp1 = 0;

    while (temp1 < D_03000ea0) {
        if (D_03000e9c[temp1] & 0x8000) {
            temp0 += D_03000e9c[temp1] >> 16;
        }
        temp1 += D_03000e9c[temp1] >> 16;
    }

    D_03004ad0.unkC = temp0 * 4;
}

#include "asm/code_08003980/asm_0800679c.s"

#include "asm/code_08003980/asm_080067a4.s"
